import 'dart:convert';

import 'package:chat/app/data/app_preference.dart';
import 'package:chat/app/data/response/auth.dart';
import 'package:chat/app/models/models.dart';
import 'package:chat/app/routes/app_pages.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:get/get.dart';

class AccountController extends GetxController {
  //TODO: Implement AccountController

  Rx<UserModel> userModel = UserModel.fromMap(jsonDecode(AppPreference().getUserModel())).obs;

  Stream<DocumentSnapshot<Map<String, dynamic>>> userStream = FirebaseFirestore.instance.collection('users').doc(AppPreference().getUid()).snapshots();

  RxBool isBack = false.obs;

  final count = 0.obs;
  @override
  void onInit() {
    print("asdasdasdasd ${userModel.value.fullName}");
    userStream.listen((event)=> getUser(event));
    super.onInit();
  }

  @override
  void onReady() {
    super.onReady();
    if(isBack.value) {
      print('object');
      update();
    }
  }

  @override
  void onClose() {
    super.onClose();
  }

  void increment() => count.value++;

  toUpdatePro5Page() async {
    isBack.value = false;
    isBack.value = await Get.toNamed(Routes.UPDATE_PROFILE, arguments: userModel);
    if(isBack.value) {
      print('asdasjkdasdbnasjkdnasjkdnasjkdn');
      update();
    }
  }


  logOut() async {
    Get.put(Auth());
    Auth.to.signOut();
    Get.offNamed(Routes.LOGIN);
  }

  getUser(DocumentSnapshot<Map<String, dynamic>> event) {
    userModel.value = UserModel.fromMap(event.data());
  }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
}

